#!/usr/bin/env bash

_exist() {
    if "$(type "$1" &>/dev/null)"; then
        echo "==> updating $1..."
    else
        echo "==> $1 doesn't appear in the PATH" >&2
    fi
}

# mac os
if [[ "$OSTYPE" == "darwin"* ]]; then
    if _exist softwareupdate; then
        softwareupdate --all --install --force
    fi
    if _exist brew; then
        brew update
        brew upgrade --greedy
        brew autoremove
        brew cleanup
    fi
fi

if _exist nix-channel; then
    nix-channel --update
fi

if _exist home-manager; then
    home-manager switch
fi

if _exist nvim; then
    nvim
    # nvim -c "PaqSync" & sleep 20 && killall nvim
    nvim -c "PlugSync" & sleep 10 && killall nvim
fi

if [[ -n "$DOTFILES" ]]; then
    cd "$DOTFILES" || exit 1
    git add ./*
    git commit -m "general: automatic update"
fi
