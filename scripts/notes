#!/bin/sh

cd "$NOTES" || exit

search_note(){
    find . -name "*.md" | fzf | xargs -r "$EDITOR" -c "cd $NOTES"
}

new_note(){
    printf "Title: " &&  read -r TITLE || exit
    TITLE_FILE=$( printf '%s' "$TITLE" | tr '[:upper:]' '[:lower:]' | sed "s/ /-/g")
    "$EDITOR" -c ":.!echo '\# $TITLE'" "$TITLE_FILE.md"
}

grep_note(){
    grep " " -R -I * | fzf | sed "s/:.*//g" | xargs -r "$EDITOR" -c "cd $NOTES"
}

view_note(){
    find . "$NOTES/pdfs" -name "*.pdf" | fzf |  xargs -r zathura
}

if [ $# = 0 ]; then
    search_note && exit;
else
  while getopts "gnv" opt; do
    case "$opt" in
      g) grep_note && exit;;
      n) new_note && exit;;
      v) view_note && exit;;
      *) exit
    esac
  done
fi
